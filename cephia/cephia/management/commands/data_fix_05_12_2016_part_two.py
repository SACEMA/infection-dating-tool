from django.core.management.base import BaseCommand, CommandError
from cephia.models import Visit, Subject
from django.db.models import Q, F
from django.db import transaction
import logging
import traceback

logger = logging.getLogger(__name__)

class Command(BaseCommand):
    help = 'Update vls for visits. To be done after visits error file is uploaded.'

    def handle(self, *args, **options):
        self.fix_visit_vls()

    def fix_visit_vls(self):
        lines = [['21940', '<20'],
                 ['21950', '<20'],
                 ['21962', '<20'],
                 ['21968', '<20'],
                 ['21973', '<20'],
                 ['21992', '<20'],
                 ['21995', '<20'],
                 ['21999', '<20'],
                 ['22020', '<20'],
                 ['22026', '<20'],
                 ['22032', '<20'],
                 ['22036', '<20'],
                 ['22054', '<20'],
                 ['22065', '<20'],
                 ['22115', '<20'],
                 ['22124', '<20'],
                 ['22146', '<20'],
                 ['22165', '<20'],
                 ['22492', ''],
                 ['22495', ''],
                 ['22013', '<20'],
                 ['22018', '<20'],
                 ['16153', '<40'],
                 ['16154', '<40'],
                 ['16155', '<40'],
                 ['16156', '<40'],
                 ['16157', '<40'],
                 ['16158', '<40'],
                 ['16159', '<40'],
                 ['16160', '<40'],
                 ['16161', '<40'],
                 ['16162', '<40'],
                 ['16163', '<40'],
                 ['16164', '<40'],
                 ['16165', '<40'],
                 ['16166', '<40'],
                 ['16167', '<40'],
                 ['22579', '<40'],
                 ['22580', '<40'],
                 ['22840', '<40'],
                 ['22841', '<40'],
                 ['22842', '<40'],
                 ['11853', '<50'],
                 ['13951', '<50'],
                 ['13952', '<50'],
                 ['14069', '<50'],
                 ['14070', '<50'],
                 ['14071', '<50'],
                 ['14072', '<50'],
                 ['14073', '<50'],
                 ['14074', '<50'],
                 ['14075', '<50'],
                 ['16112', '<50'],
                 ['16113', '<50'],
                 ['16114', '<50'],
                 ['16115', '<50'],
                 ['16116', '<50'],
                 ['16117', '<50'],
                 ['16118', '<50'],
                 ['16119', '<50'],
                 ['16120', '<50'],
                 ['16121', '<50'],
                 ['16122', '<50'],
                 ['16123', '<50'],
                 ['16124', '<50'],
                 ['16125', '<50'],
                 ['16126', '<50'],
                 ['16127', '<50'],
                 ['16128', '<50'],
                 ['16129', '<50'],
                 ['16130', '<50'],
                 ['16131', '<50'],
                 ['16132', '<50'],
                 ['16133', '<50'],
                 ['16134', '<50'],
                 ['16135', '<50'],
                 ['23541', '<50'],
                 ['23571', '<50'],
                 ['23882', '<50'],
                 ['23911', '<50'],
                 ['24113', '<50'],
                 ['16103', '<50'],
                 ['16104', '<50'],
                 ['16105', '<50'],
                 ['16106', '<50'],
                 ['16107', '<50'],
                 ['16108', '<50'],
                 ['16109', '<50'],
                 ['16110', '<50'],
                 ['16111', '<50'],
                 ['22282', '<50'],
                 ['22286', '<50'],
                 ['23468', '<50']
        ]

        for i in lines:
            vl_reported = i[1]
            try:
                visit = Visit.objects.get(pk=i[0])

                if vl_reported != '':
                    visit.vl_reported = vl_reported
                else:
                    visit.vl_reported = None
                visit.save()
            except Visit.DoesNotExist:
                pass
