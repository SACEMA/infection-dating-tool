{% extends "cephia/base.html" %}
{% load bootstrap3 %}
{% load endless %}


{% block submit_action %}
{% url 'file_info' %}
{% endblock %}

{% block filter_col_a %}
{% bootstrap_field filter_form.file_type %}
{% endblock %}

{% block filter_col_b %}
{% bootstrap_field filter_form.state %}
{% endblock %}

{% block filter_col_c %}
{% bootstrap_field filter_form.created %}
{% endblock %}

{% block info_content %}
<div class="container">
  <div class="row">
    <div class="panel panel-default" style="box-shadow: 10px 10px 5px #888888;">
      <div class="panel-heading">
        <h3 class="panel-title">Information</h3>
      </div>
      <div class="panel-body">
        <div class="row">
          {% block info_col_a %}
          {% endblock %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block page_content %}

{% paginate files %}
<div class="container">
  <div class="row">
    <div class="panel panel-default" style="box-shadow: 10px 10px 5px #888888;">
      <div class="panel-heading">
        <h3 class="panel-title">Files</h3>
      </div>
      <div class="panel-body">
        <div class="row">
          <div class="container"
               {% show_pages %}
            <div class="table-responsive">
              <table class="table-striped table table-hover">
                <thead>
	          <th></th>
	          <th>Name</th>
	          <th>Type</th>
	          <th>Created</th>
	          <th>State</th>
	          <th>Download</th>
	          <th>Message</th>
                </thead>
                <tbody>
	          {% for file in files %}
	          <tr>
	            <td><a href="{% url 'row_info' file.id %}">Detail</a></td>
	            <td>{{file.filename}}</td>
	            <td>{{file.file_type}}</td>
	            <td>{{file.created}}</td>
	            <td>{{file.state}}</td>
	            <td><a href="{% url 'download_file' file.id %}">Download</a></td>
	            <td data-toggle="tooltip" title="{{file.message}}">{{file.message}}</td>
	            <td>
	              {% if file.state == 'pending' %}
	              <a href="{% url 'parse_file' file.id %}" class="btn btn-default btn-sm">Import</a>
	              {% elif file.state == 'imported' %}
	              <a href="{% url 'validate_rows' file.id %}" class="btn btn-default btn-sm">Validate</a>
	              {% elif file.state == 'validated' or file.state == 'error' %}
	              <a href="{% url 'process_file' file.id %}" class="btn btn-default btn-sm">Process</a>
	              {% endif %}
	            </td>
	          </tr>
	          {% endfor %}
                </tbody>
              </table>

              {% include 'cephia/upload_file.html' with upload_form=upload_form %}

              {% include 'cephia/message_modal.html'%}

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
