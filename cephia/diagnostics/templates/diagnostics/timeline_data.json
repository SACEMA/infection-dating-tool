{% load common_tags %}
[
    {
        "id":"{{subject.id}}",
        "title":"Subject - {{subject.subject_label}} Diagnostic Test Timeline",
        "description":"",
        "focus_date":"{{subject.subject_eddi.tci_begin|date:'Y-m-d'}}",
        "initial_zoom":"25",
        "image_lane_height":0,
        "events":[
            {
                "id":"{{test.id}}_excluded",
                "title": "",
                "description":"Viral Detection Window",
                "startdate": "{{subject.subject_eddi.tci_begin|date:'Y-m-d'}}",
                "enddate": "{{subject.subject_eddi.tci_end|date:'Y-m-d'}}",
                "importance":"50",
                "date_display":"ye",
                "y_position":5,
                "link":"",
                "icon":"star_gray.png",
                "css_class":"vdw"
            },            
            {% for test in tests %}
            {
                "id":"{{test.id}}_excluded",
                "title": "",
                "description":"Test Date: {{test.test_date}}<br/> Adjusted Date: {{test.adjusted_date}}<br/> Test Result: {{test.test_result}}",
                "startdate": {% if test.test_result == 'Negative' %}"1980-01-01"{% else %}"{{test.adjusted_date|date:'Y-m-d'}}"{% endif %},
                "enddate": {% if test.test_result == 'Negative' %}"{{test.adjusted_date|date:'Y-m-d'}}"{% else %}"today"{% endif %},
                "importance":"30",
                "date_display":"ye",
                "y_position":{{30|multiply:forloop.counter}},
                "link":"",
                "icon":""
            },
            {
                "id":"{{test.id}}_marker",
                "title": "{{test.test.name}}",
                "description":"Test Date: {{test.test_date}}<br/> Adjusted Date: {{test.adjusted_date}}<br/> Test Result: {{test.test_result}}",
                "startdate": "{{test.test_date|date:'Y-m-d'}}",
                "importance":"30",
                "date_display":"ye",
                "y_position":{{30|multiply:forloop.counter}},
                "link":"",
                "icon":{% if test.test_result == 'Negative' %}"triangle_left_green.png"{% else %}"triangle_red.png"{% endif %}
            }{% if not forloop.last %},{% endif %}
            {% endfor %}

        ],
        "legend": [
            {"title":"negative", "icon":"triangle_left_green.png"},
            {"title":"positive", "icon":"triangle_red.png"},
            {"title":"VDW", "icon":"star_gray.png"}
        ]
        
    }
]
