{% load bootstrap3 %}
{% load common_tags %}
<div class="container">
  <form id="eddi-status-form" data-subject-id="{{subject.id}}" enctype="multipart/form-data" role="form" method="POST">
    {{ history_formset.management_form }} 
    <div class="modal fade" id="eddiModal">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            <h4 class="modal-title">All test history for Subject - {{subject.subject_label}} from {{subject.source_study}} </h4>
          </div>
          <div class="modal-body eddi-modal-body">
            <div class="table-responsive" style="overflow:auto; max-height:500px;"">
              <div class="alert alert-success status-message"></div>
              <div class="col-md-4">{% bootstrap_field status_form.status %}</div>
              <div class="col-md-8">{% bootstrap_field status_form.comment %}</div>
              <table class="table-striped table table-hover">
                <thead>
                  <th>Test Date</th>
                  <th>Adjusted Date</th>
                  <th>Test Name</th>
                  <th>Test Estimate</th>
                  <th>Test Result</th>
                  <th>Ignore</th>
                </thead>
                <tbody class="eddi-modal">
                  {% for history in history_formset %}
                  {% if history.instance.test_date %}
                  {{history.id}}
                  <tr>
                    <td>{{history.instance.test_date}}</td>
                    <td>{{history.instance.adjusted_date}}</td>
                    <td>{{history.instance.test.name}}</td>
                    <td>{{test_properties|get_item:history.instance.test.id}}</td>
                    <td>{{history.instance.test_result}}</td>
                    <td>{{history.ignore}}</td>
                  </tr>
                  {% endif %}
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
          <div class="modal-footer">
            <a class="btn btn-primary view-timeline" href="{% url 'diagnostics:subject_test_timeline' subject_id=subject.id %}" target="_blank">View Timeline</a>
            <a class="btn btn-primary eddi-status-update">Save</a>
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>

